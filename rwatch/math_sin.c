/* math_sin.c
 * LUT-based sine table
 * libRebbleOS
 *
 * Author: Barry Carter <barry.carter@gmail.com>
 */

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdint.h>
#include <inttypes.h>
#include "librebble.h"

// taken from 
// https://github.com/jonpry/pebblesim/blob/master/sin.c
// it has no license

// lookup points on the first quarter sin wave
// generated by tintin/tools/trigTable.py
static const int32_t SIN_LOOKUP[] = {
0,
401,
801,
1202,
1602,
2002,
2403,
2803,
3203,
3603,
4003,
4403,
4802,
5202,
5601,
6000,
6399,
6797,
7195,
7593,
7991,
8389,
8786,
9182,
9579,
9975,
10371,
10766,
11161,
11555,
11949,
12343,
12736,
13129,
13521,
13913,
14304,
14694,
15085,
15474,
15863,
16251,
16639,
17026,
17413,
17798,
18184,
18568,
18952,
19335,
19717,
20099,
20480,
20860,
21239,
21618,
21996,
22372,
22749,
23124,
23498,
23872,
24244,
24616,
24987,
25356,
25725,
26093,
26460,
26826,
27191,
27555,
27918,
28280,
28641,
29000,
29359,
29717,
30073,
30428,
30783,
31136,
31487,
31838,
32188,
32536,
32883,
33229,
33574,
33917,
34259,
34600,
34939,
35278,
35614,
35950,
36284,
36617,
36949,
37279,
37608,
37935,
38261,
38585,
38908,
39230,
39550,
39869,
40186,
40502,
40816,
41128,
41439,
41749,
42057,
42363,
42668,
42971,
43273,
43573,
43871,
44168,
44463,
44757,
45048,
45338,
45627,
45913,
46198,
46482,
46763,
47043,
47321,
47597,
47872,
48144,
48415,
48684,
48951,
49217,
49480,
49742,
50002,
50260,
50516,
50770,
51023,
51273,
51521,
51768,
52013,
52255,
52496,
52735,
52972,
53207,
53440,
53670,
53899,
54126,
54351,
54574,
54794,
55013,
55230,
55444,
55657,
55867,
56076,
56282,
56486,
56688,
56888,
57086,
57281,
57475,
57666,
57856,
58043,
58228,
58410,
58591,
58769,
58945,
59119,
59291,
59461,
59628,
59793,
59956,
60116,
60275,
60431,
60585,
60736,
60886,
61033,
61177,
61320,
61460,
61598,
61734,
61867,
61998,
62126,
62253,
62377,
62498,
62618,
62735,
62850,
62962,
63072,
63179,
63285,
63388,
63488,
63586,
63682,
63775,
63866,
63955,
64041,
64125,
64206,
64286,
64362,
64436,
64508,
64578,
64645,
64709,
64771,
64831,
64889,
64943,
64996,
65046,
65094,
65139,
65182,
65222,
65260,
65295,
65328,
65359,
65387,
65413,
65436,
65457,
65475,
65491,
65504,
65515,
65524,
65530,
65534,
65535
};

int32_t sin_lookup(int32_t angle) {
  int32_t mult = 1;

	// modify the input angle and output multiplier for use in a first quadrent sine lookup
	if (angle < 0) {
		angle = -angle;
		mult = -mult;
	}
	if (angle >= TRIG_MAX_ANGLE) {
		angle %= TRIG_MAX_ANGLE;
	}
	if (angle >= TRIG_MAX_ANGLE / 2) {
		mult = -mult;
		angle -= TRIG_MAX_ANGLE / 2;
	}
	if (angle >= TRIG_MAX_ANGLE / 4 && angle <= TRIG_MAX_ANGLE / 2) {
		angle = TRIG_MAX_ANGLE / 2 - angle;
	}

	// if I can interpolate linearly
	int32_t lookup_angle =  angle * 4 / 0xff;
	if ((uint32_t)(lookup_angle + 1) < sizeof(SIN_LOOKUP) / sizeof(int32_t)) {
		return  mult * (SIN_LOOKUP[lookup_angle] + ((angle * 4) % 0xff) * (SIN_LOOKUP[lookup_angle + 1] - SIN_LOOKUP[lookup_angle]) / 0xff);
	}
	
	return mult * SIN_LOOKUP[lookup_angle];
}

int32_t cos_lookup(int32_t angle) {
	return sin_lookup(angle + TRIG_MAX_ANGLE / 4);
}
